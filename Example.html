<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"> 
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">  
    <meta name="description" content="мета теги в html документе. не больше 100 символов."> 
    <meta name="keywords" content="реклама, дизайн, полиграфия /*до 30 символов*/">   
    <title>document</title>
    <!-- <link rel="stylesheet" type="text/css" href="style.css"> -->
  </head>
  <body>
  	<div>
	<table border="1" id="myTable" style="display: inline; margin-right: 10%">
		<thead>
			<tr>
				<th>X</th>
				<th>Y</th>
			</tr>
		</thead>
		<tbody>

		</tbody>
	</table>
	
	<label> y = <input onkeyup="testing()" type="text" name="" value="ax^1 + bx^2" class="data"></label>
	<button  onclick="exec()" id="btn">Порахувати</button>
	</div>

	<hr>

  	<div id="result"></div>

  	<script type="text/javascript">

  		let counter = 1;
  		let counter2 = 1;
  		let counter3 = 1;
  		let n = +prompt("Введіть кількість елементів","5");
	    let tableRef = document.getElementById('myTable').getElementsByTagName('tbody')[0];
  		
  		let x = [];
  		// for (let i = 1, q = 0.1; i <= n, q <= 2.1; i++, q += 0.1) {
  		for (let i = 1; i <= n; i++) {
            let row = document.createElement("tr");
            x[i - 1] = i;/////////////////////////////////////////////////////////////////////////////////////////////////
            // x[i - 1] = q;
            for (let j = 0; j < 2; j++) {

             	let cell = document.createElement("td");

             	if(j == 0){   
                	// let cellText = document.createTextNode(q);/////////////////////////////////////////////////////////////////////////
                	let cellText = document.createTextNode(i);
                	cell.appendChild(cellText); 
            	} else {
            		let cellText = document.createElement('input');
            		cellText.setAttribute("type", "number");
            		cellText.setAttribute("class", i);
            		cellText.setAttribute("placeholder", "Введіть дані");
            		cellText.setAttribute("value", i);
                	cell.appendChild(cellText); 
            	}

                
                row.appendChild(cell);
            }

            tableRef.appendChild(row);
        }

        function paint(M, c){
        	if(c === 5){
        		var mass = ["a = ", "b = ", "c = ", "d= ", "e = ", "f = ", "g = ", "h = ", "i = ", "j = ", "k = ", "l = ", "m = ", "n = ", "o = ", "p = ", "Q = ", "r = ", "s = ", "t = ", "u = ", "v = ", "w = ", "x = ", "x = ", "y = ", "z = "];
        	}
        	var body = document.getElementById("result");
        	var tbl     = document.createElement("table");
        	var tblBody = document.createElement("tbody");

        	for (var i = 0; i < M.length; i++){
        		var row = document.createElement("tr");

		        for (var j = 0; j <= M[i].length; j++){

		        	if((c === 5) && (j === 0)){
		        		var cell = document.createElement("td");    
		            	var cellText = document.createTextNode(mass[i]);
		            	cell.appendChild(cellText);
		           		row.appendChild(cell);
		        	} else if((c === 5) && (j > 0)){
		        		var cell = document.createElement("td"); 
	            		var cellText = document.createTextNode(M[i][j - 1]);
						cell.appendChild(cellText);
			            row.appendChild(cell);
			        } else {

		        		if(j === M[i].length){
		        			break;
		        		}

	            		var cell = document.createElement("td"); 
	            		var cellText = document.createTextNode(M[i][j]); 
			            cell.appendChild(cellText);
			            row.appendChild(cell);
		            }

		        }
		        tblBody.appendChild(row);
		    }
		    tbl.appendChild(tblBody);
	        body.appendChild(tbl);
	        tbl.setAttribute("border", "1");
	        tbl.setAttribute("id", "tableExp");
	        // tableExp.style.cssText = "display: none";
        }

        function testing(){
        	let btnValue = document.getElementsByClassName("data")[0].value;
        	let rep = /[^\^+a-zA-Z\d\s]/;
	        if (rep.test(btnValue)) {
	            btnValue = btnValue.replace(rep, '');
	            document.getElementsByClassName("data")[0].value = btnValue;
	        }
        }




        function exec() {
        	result.innerHTML = "";
        	counter = 1;
       		counter2 = 1;
       		counter3 = 1;
        	let btnValue = document.getElementsByClassName("data")[0].value;
        	let arrayOfStrings = btnValue.trim().split("+");

        	let X = [];
        	
        	result.innerHTML += "На данный момент массив Х має вигляд:";

        	var body0 = document.getElementById("result");
        	var tbl0     = document.createElement("table");
        	var tblBody0 = document.createElement("tbody");
        	var row0 = document.createElement("tr");
        	var cell0 = document.createElement("td");  





			var body1 = document.getElementsByTagName("body")[0];
        	var tbl1     = document.createElement("table");
        	var tblBody1 = document.createElement("tbody");

        	for(var i = 0; i < n; i++){
        		X[i] = [];
        		var row1 = document.createElement("tr");
        		for (var j = 0; j < arrayOfStrings.length; j++) {
        			// if(j == 0){
        			// 	X[i][j] = 1;
        			// } else {
        			// X[i][j] = +document.getElementsByClassName(i + 1)[0].value;
        			
				        for (var col = 0; col < arrayOfStrings[j].length; col++){

				            if(j == 0){
				           	   if((arrayOfStrings[j][col] === "x" || arrayOfStrings[j][col] === "X") && arrayOfStrings[j][col + 1] === "^" && parseInt( arrayOfStrings[j][col + 2])){
				           	   		X[i][j] = Math.pow(x[i], parseInt(arrayOfStrings[j][col + 2]));
				           	   		break;
				           	    } 
				           	    else {
				           	    	X[i][j] = 1;
				           	    	// break;
				           	    }
				            } else {
					            if((arrayOfStrings[j][col] === "x" || arrayOfStrings[j][col] === "X") && arrayOfStrings[j][col + 1] === "^" && parseInt(arrayOfStrings[j][col + 2])){
					        		// alert(parseInt(x[i] * parseInt(arrayOfStrings[j][col + 2])));
					        		X[i][j] = Math.pow(x[i], parseInt(arrayOfStrings[j][col + 2]));
					        		break;
					        	} 
					        	else {
				        			X[i][j] = x[i];
				        			// break;
				        		}
							}
				        }

        			//X[i][j] = x[i];
        			// }
        			var cell1 = document.createElement("td");    
		            var cellText1 = document.createTextNode(X[i][j]); 

		            cell1.appendChild(cellText1);
		            row1.appendChild(cell1);
        		}
        		 tblBody1.appendChild(row1);
        	}

        	// alert(i);
        	// alert(j);
        	// alert(col);
        	tbl1.appendChild(tblBody1);
	        body1.appendChild(tbl1);
	        tbl1.setAttribute("border", "1");
	        // tbl1.setAttribute("width", "50%");
	        // result.innerHTML += "<br><hr>";
	        // var cellText = document.createTextNode(X[i][j]); 






            cell0.appendChild(tbl1);
            row0.appendChild(cell0);
            // tblBody0.appendChild(row0);
            // tbl0.appendChild(tblBody0);
            // body0.appendChild(tbl0);


            var cell00 = document.createElement("td");


	        var body3 = document.getElementsByTagName("body")[0];
	        var tbl3     = document.createElement("table");
        	var tblBody3 = document.createElement("tbody");
        	// result.innerHTML += "На данный момент массив Y має вигляд:<br>";
        	let Y = [];
        	
        	for(let i = 0; i < n; i++){
        		Y[i] = [];
        		var row3 = document.createElement("tr");
        		Y[i][0] = +document.getElementsByClassName(i + 1)[0].value;

        		var cell3 = document.createElement("td");    
	            var cellText3 = document.createTextNode(Y[i][0]); 

	            cell3.appendChild(cellText3);
	            row3.appendChild(cell3);
	            tblBody3.appendChild(row3);
        	}
        	

        	tbl3.appendChild(tblBody3);
	        body3.appendChild(tbl3);
	        tbl3.setAttribute("border", "1");
    		// tbl.setAttribute("display", "inline");



    		cell00.appendChild(tbl3);
            row0.appendChild(cell00);
            tblBody0.appendChild(row0);
            tbl0.appendChild(tblBody0);
	        body0.appendChild(tbl0);
	        tbl0.setAttribute("border", "0");
	        tbl0.setAttribute("width", "50%");



			let Btrans = TransMatrix(X);

			result.innerHTML += "<hr>";
			let B = MultiplyMatrix(Btrans, X);
			result.innerHTML += "<hr>";	

			B = InverseMatrix(B);	
			result.innerHTML += "<hr>";


			B = MultiplyMatrix(B, Btrans);
			result.innerHTML += "<hr>";

			B = MultiplyMatrix(B, Y, 5);
			// result.innerHTML += "<hr>";


			// result.innerHTML += B;
        }

	    // let a = [
	    // [2, 5, 7],
	    // [6, 3, 4],
	    // [5, -2, -3]
	    // ];



	    function TransMatrix(A)       //На входе двумерный массив
		{	
			result.innerHTML += "<br>" + counter + ")Виконуємо пошук транспонованої матриці " + A + " :<br>";
		    let m = A.length, n = A[0].length, AT = [];

		    for (let i = 0; i < n; i++){ 
		        AT[ i ] = [];
		        for (let j = 0; j < m; j++) {
			       	AT[ i ][j] = A[j][ i ];
		        }

		    }

        	counter++;
        	paint(AT);
		    return AT;
		}

		// let b = TransMatrix(a);


		function Determinant(A)   // Используется алгоритм Барейса, сложность O(n^3)
		{
			result.innerHTML += "<br>";
			// alert(Determinant.caller);
			if(Determinant.caller == InverseMatrix){
				result.innerHTML += "\u00A0\u00A0\u00A0\u00A0"  + counter + "." + counter2 + ")Виконуємо пошук детермінанту матриці " + A + " :<br>";;
			} else {
				result.innerHTML += "\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0"  + counter + "." + counter2 + "." + counter3 + ")Виконуємо пошук детермінанту матриці " + A + " :<br>";
			}

		    let N = A.length, B = [], denom = 1, exchanges = 0;

		    if(N < 1){
		    	alert("Потрібно мінімум 2 параметра");
		    	return false;
		    }

		    for (let i = 0; i < N; ++i)
		     { B[ i ] = [];
		       for (let j = 0; j < N; ++j) B[ i ][j] = A[ i ][j];
		     }
		    for (let i = 0; i < N-1; ++i)
		     { let maxN = i, maxValue = Math.abs(B[ i ][ i ]);
		       for (let j = i+1; j < N; ++j)
		        { let value = Math.abs(B[j][ i ]);
		          if (value > maxValue){ maxN = j; maxValue = value; }
		        }
		       if (maxN > i)
		        { let temp = B[ i ]; B[ i ] = B[maxN]; B[maxN] = temp;
		          ++exchanges;
		        }
		       else { if (maxValue == 0) {
		       			if(Determinant.caller == InverseMatrix){
							result.innerHTML += "\u00A0\u00A0\u00A0\u00A0" + maxValue + " - Максимальне значення<br>";
						} else {
							result.innerHTML += "\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0" + maxValue + " - Максимальне значення<br>";
						}
			       		return maxValue;
			       		}
		       		}
		       let value1 = B[ i ][ i ];
		       for (let j = i+1; j < N; ++j)
		        { let value2 = B[j][ i ];
		          B[j][ i ] = 0;
		          for (let k = i+1; k < N; ++k) B[j][k] = (B[j][k]*value1-B[ i ][k]*value2)/denom;
		        }
		       denom = value1;
		     }
		    if (exchanges%2){
		    	if(Determinant.caller == InverseMatrix){
		    		counter2++;
					result.innerHTML += "\u00A0\u00A0\u00A0\u00A0" + (-B[N-1][N-1]) + "<br>";
				} else {
					counter3++;
					result.innerHTML += "\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0" + (-B[N-1][N-1]) + "<br>";
				}
		    	return -B[N-1][N-1];
		    }
		    else {
		    	if(Determinant.caller == InverseMatrix){
		    		counter2++;
					result.innerHTML += "\u00A0\u00A0\u00A0\u00A0" + B[N-1][N-1] + "<br>";
				} else {
					counter3++;
					result.innerHTML += "\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0\u00A0" + B[N-1][N-1] + "<br>";
				}
		    	return B[N-1][N-1];
		    }
		}

		function AdjugateMatrix(A)   // A - двумерный квадратный массив
		{              
			result.innerHTML += "<br>\u00A0\u00A0\u00A0\u00A0" + counter + "." + counter2 + ")Виконуємо пошук союзної матриці "
			paint(A);
			result.innerHTML += "&darr;<br>";                          
		    let N = A.length, adjA = [];
		    for (let i = 0; i < N; i++)
		     { adjA[ i ] = [];
		       for (let j = 0; j < N; j++)
		        { let B = [], sign = ((i+j)%2==0) ? 1 : -1;
		          for (let m = 0; m < j; m++)
		           { B[m] = [];
		             for (let n = 0; n < i; n++)   B[m][n] = A[m][n];
		             for (let n = i+1; n < N; n++) B[m][n-1] = A[m][n];
		           }
		          for (let m = j+1; m < N; m++)
		           { B[m-1] = [];
		             for (let n = 0; n < i; n++)   B[m-1][n] = A[m][n];
		             for (let n = i+1; n < N; n++) B[m-1][n-1] = A[m][n];
		           }
		          adjA[ i ][j] = sign*Determinant(B);   // Функцию Determinant см. выше
		        }
		     }
		    counter2++;
		    paint(adjA);
		     result.innerHTML += "<br>";
		    return adjA;
		}

		function InverseMatrix(A)   // A - двумерный квадратный массив
		{   	   

		    result.innerHTML += "<br>" + counter + ")Виконуємо пошук інвертованої матриці ";
		    paint(A);
		    result.innerHTML += "&darr;<br>";

		    let det = Determinant(A);                // Функцию Determinant см. выше
		    if (det == 0) {
		    	result.innerHTML += "Детермінант матриці " + A + " = 0<br>";
		    	result.innerHTML += "Знаходження інвертованої матриці неможливе<br>";
		    	return false;
		    }
		    var N = A.length, A = AdjugateMatrix(A); // Функцию AdjugateMatrix см. выше
		    for (let i = 0; i < N; i++){ 

		     	for (let j = 0; j < N; j++) {
		     		A[ i ][j] /= det;
		     	} 

		    }

        	counter++;
        	paint(A);
		    return A;
		}

		function MultiplyMatrix(A,B, c)
		{
			// var xValuea = eval(A);
			// var xValueb = eval(B);
 			// var xValueA = window[a[0]];
 			
 			// var body = document.getElementById("result");
    //     	var tbl     = document.createElement("table");
    //     	var tblBody = document.createElement("tbody");
        	
    //     	for (var i = 0; i < M.length; i++){
    //     		var row = document.createElement("tr");

		  //       for (var j = 0; j < M[i].length; j++){

		  //          	var cell = document.createElement("td");    
		  //           var cellText = document.createTextNode(M[i][j]); 
		  //           cell.appendChild(cellText);
		  //           row.appendChild(cell);

		  //       }
		  //       tblBody.appendChild(row);
		  //   }
		  //   tbl.appendChild(tblBody);
	   //      body.appendChild(tbl);
	   //      tbl.setAttribute("border", "1");
	   //      tbl.setAttribute("id", "tableExp");


			result.innerHTML += "<br>" + counter + ")Виконуємо множення матриці ";
			paint(A);
			result.innerHTML += " на матрицю ";
			paint(B);
			result.innerHTML += "&darr;<br>";
			
		    let rowsA = A.length, colsA = A[0].length,
		        rowsB = B.length, colsB = B[0].length,
		        C = [];
	        
		    if (colsA != rowsB) {
		    	result.innerHTML += "Кількість стовпців матриці " + A + " не дорівнює кількості рядків матриці " + B + "<br>";
		    	result.innerHTML += "Множення матриць неможливе<br>";
		    	return false;
		    }

		    var body = document.getElementById("result");
        	var tbl     = document.createElement("table");
        	var tblBody = document.createElement("tbody");

		    for (let i = 0; i < rowsA; i++) {
		    	C[ i ] = [];
		    }

		    for (let k = 0; k < colsB; k++){ 
				var row = document.createElement("tr");
		     		for (let i = 0; i < rowsA; i++){ 
			          let t = 0;
			           var cell = document.createElement("td"); 

			          for (let j = 0; j < rowsB; j++) {
			          	t += A[ i ][j]*B[j][k];
			          	// result.innerHTML += "Виконуємо множення: " + A[ i ][j] + " * " + B[j][k] + " = " + (A[ i ][j] * B[j][k]) + "<br>";
			          	if(j === rowsB - 1){
			          		var cellText = document.createTextNode(A[ i ][j] + " * " + B[j][k]); 
			          	} else {
			          		var cellText = document.createTextNode(A[ i ][j] + " * " + B[j][k] +  " + "); 
			          	}
		           		cell.appendChild(cellText);
			          }
			          
			            
		            
		            row.appendChild(cell);
		             // var par = parseInt(t, 10);
			          C[ i ][k] = t;
			          // result.innerHTML += "Заносимо до масиву результат: " + t + "<br>";
			        }
			        tblBody.appendChild(row);

		     }
		      tbl.appendChild(tblBody);
	        body.appendChild(tbl);
	        tbl.setAttribute("border", "1");
		     // alert(rowsA);
		     // alert(colsB);
		     //  alert(rowsB);
		     result.innerHTML += "&darr;<br>";
        	 counter++;
        	 if(c === 5){
        	 	// alert("srabotalo v posledney iteracii");
        	 	 paint(C, 5);
        	 } else {
        	 	paint(C);
        	 }	
		     return C;
		}


	// let b = TransMatrix(a);

	// 	console.log(b);

  	</script>

  </body>
</html>